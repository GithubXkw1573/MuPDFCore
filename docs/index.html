<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.5"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>MuPDFCore: MuPDFCore: Multiplatform .NET bindings for MuPDF</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
<link href="Doxy.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectlogo"><img alt="Logo" src="icon.svg"/></td>
  <td id="projectalign">
   <div id="projectname">MuPDFCore<span id="projectnumber">&#160;1.8.0</span>
   </div>
   <div id="projectbrief">Multiplatform .NET bindings for MuPDF</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.5 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title"><a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a>: Multiplatform .NET bindings for MuPDF </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p ><a class="anchor" id="md_Readme"></a> <img src="icon.svg" alt="" style="pointer-events: none;" width="256" align="right" class="inline"/></p>
<p ><a href="https://www.gnu.org/licenses/agpl-3.0"><img src="https://img.shields.io/badge/License-AGPL_v3-blue.svg" alt="License: AGPL v3" style="pointer-events: none;" class="inline"/></a> <a href="https://nuget.org/packages/MuPDFCore"><img src="https://img.shields.io/nuget/v/MuPDFCore" alt="Version" class="inline"/></a></p>
<p ><b><a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a></b> is a set of multiplatform .NET bindings for <a href="https://mupdf.com/">MuPDF</a>. It can render PDF, XPS, EPUB and other formats to raster images returned either as raw bytes, or as image files in multiple formats (including PNG, JPEG, and PSD). It also supports multithreading.</p>
<p >It also includes <b><a class="el" href="namespace_mu_p_d_f_core_1_1_mu_p_d_f_renderer.html">MuPDFCore.MuPDFRenderer</a></b>, an <a class="el" href="namespace_avalonia.html">Avalonia</a> control to display documents compatible with <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> in <a class="el" href="namespace_avalonia.html">Avalonia</a> windows (with multithreaded rendering).</p>
<p >The library is released under the <a href="https://www.gnu.org/licenses/agpl-3.0.html">AGPLv3</a> licence.</p>
<h1><a class="anchor" id="autotoc_md1"></a>
Getting started</h1>
<p >The <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> library targets .NET Standard 2.0, thus it can be used in projects that target .NET Standard 2.0+, .NET Core 2.0+, .NET 5.0+, .NET Framework 4.6.1 (note) and possibly others. <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> includes a pre-compiled native library, which currently supports the following platforms:</p>
<ul>
<li>Windows x86 (32 bit) <code>win-x86</code></li>
<li>Windows x64 (64 bit) <code>win-x64</code></li>
<li>Windows arm64 (ARM 64 bit) <code>win-arm64</code></li>
<li>Linux x64 (64 bit)<ul>
<li>glibc-based <code>linux-x64</code></li>
<li>musl-based <code>linux-musl-x64</code></li>
</ul>
</li>
<li>Linux arm64/aarch64 (ARM 64 bit)<ul>
<li>glibc-based <code>linux-arm64</code></li>
<li>musl-based <code>linux-musl-arm64</code> (see [note](muslNote))</li>
</ul>
</li>
<li>macOS Intel x86_64 (64 bit) <code>osx-x64</code></li>
<li>macOS Apple silicon (ARM 64 bit) <code>osx-arm64</code></li>
</ul>
<p >To use the library in your project, you should install the <a href="https://www.nuget.org/packages/MuPDFCore/">MuPDFCore NuGet package</a> and/or the <a href="https://www.nuget.org/packages/MuPDFCore.MuPDFRenderer/">MuPDFCore.PDFRenderer NuGet package</a>. When you publish a program that uses <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a>, the correct native library for the target architecture will automatically be copied to the build folder (but see the note for .NET Framework).</p>
<p ><b>Note</b>: you should make sure that end users on <b>Windows</b> install the <a href="https://docs.microsoft.com/en-us/cpp/windows/latest-supported-vc-redist?view=msvc-160#visual-studio-2015-2017-2019-and-2022">Microsoft Visual C++ Redistributable for Visual Studio 2015, 2017, 2019 and 2022</a> for their platform, otherwise they will get an error message stating that <code>MuPDFWrapper.dll</code> could not be loaded because a module was not found.</p>
<p ><a class="anchor" id="muslNote"></a><b>Note</b> for **<code>musl</code>-based Linux arm64**: I could not find a way to ensure that the linux-musl-arm64 native artifact overwrites the linux-arm64 (<code>glibc</code>) artifact. As a result, when you publish a project that uses <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> targeting linux-musl-arm64, you will find <em>two</em> native assets in the build directory (<code>MuPDFWrapper.so</code>, which is the <code>musl</code> artifact, and <code>libMuPDFWrapper.so</code>, which is the <code>glibc</code> artifact). Everything will work fine out of the box (because the name of the <code>musl</code> artifact has higher priority), but you may want to delete <code>libMuPDFWrapper.so</code> in order to reduce size. You can use e.g. a post-build target to do this.</p>
<h1><a class="anchor" id="autotoc_md2"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md3"></a>
Documentation</h2>
<p >You can find detailed descriptions of how to use <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> and some code examples in the <a href="https://github.com/arklumpus/MuPDFCore/wiki">MuPDFCore wiki</a>. Interactive documentation for the library API can be accessed from the <a href="https://arklumpus.github.io/MuPDFCore/">documentation website</a>. A <a href="https://arklumpus.github.io/MuPDFCore/MuPDFCore.pdf">PDF reference manual</a> is also available.</p>
<h2><a class="anchor" id="autotoc_md4"></a>
Minimal working example</h2>
<p >The following example shows the bare minimum code necessary to render a page of a PDF document to a PNG image using <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a>:</p>
<div class="fragment"><div class="line"><span class="comment">//Initialise the MuPDF context. This is needed to open or create documents.</span></div>
<div class="line"><span class="keyword">using </span>MuPDFContext ctx = <span class="keyword">new</span> MuPDFContext();</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Open a PDF document</span></div>
<div class="line"><span class="keyword">using </span>MuPDFDocument document = <span class="keyword">new</span> MuPDFDocument(ctx, <span class="stringliteral">&quot;path/to/document.pdf&quot;</span>);</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Page index (page 0 is the first page of the document)</span></div>
<div class="line"><span class="keywordtype">int</span> pageIndex = 0;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Zoom level, converting document units into pixels. For a PDF document, a 1x zoom level corresponds to a</span></div>
<div class="line"><span class="comment">//72dpi resolution.</span></div>
<div class="line"><span class="keywordtype">double</span> zoomLevel = 1;</div>
<div class="line"> </div>
<div class="line"><span class="comment">//Save the first page as a PNG image with transparency, at a 1x zoom level (1pt = 1px).</span></div>
<div class="line">document.SaveImage(pageIndex, zoomLevel, PixelFormats.RGBA, <span class="stringliteral">&quot;path/to/output.png&quot;</span>, RasterOutputFileTypes.PNG);</div>
</div><!-- fragment --><p >Look at the <a href="https://github.com/arklumpus/MuPDFCore/wiki">wiki</a> for more information.</p>
<h2><a class="anchor" id="autotoc_md5"></a>
Examples</h2>
<p >The <a href="https://github.com/arklumpus/MuPDFCore/tree/master/Demo">Demo</a> folder in the repository contains some examples of how the library can be used to extract pages from a PDF or XPS document, render them to a raster image, or combine them in a new document</p>
<p >The <a href="https://github.com/arklumpus/MuPDFCore/tree/master/PDFViewerDemo">PDFViewerDemo</a> folder contains a complete (though minimal) example of a PDF viewer program built around the <code><a class="el" href="class_mu_p_d_f_core_1_1_mu_p_d_f_renderer_1_1_p_d_f_renderer.html" title="A control to render PDF documents (and other formats), potentally using multiple threads.">MuPDFCore.MuPDFRenderer.PDFRenderer</a></code> control.</p>
<p >Note that these examples intentionally avoid any error handling code: in a production setting, you should typically make sure that calls to <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> library functions are within a <code>try...catch</code> block to handle any resulting <code>MuPDFException</code>s.</p>
<h1><a class="anchor" id="autotoc_md6"></a>
Building from source</h1>
<p >Building the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> library from source requires the following steps:</p>
<ol type="1">
<li>Building the <code>libmupdf</code> native library</li>
<li>Building the <code>MuPDFWrapper</code> native library</li>
<li>Creating the <code>MuPDFCore.NativeAssets.xxx-yyy</code> native assets NuGet packages</li>
<li>Creating the <code><a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a></code> library NuGet package</li>
</ol>
<p >Starting from <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> 1.8.0, the native assets are split into their own NuGet packages, on which the main <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> package depends. Aside from reducing the size of individual packages, this means that if you are making changes that do not affect the native assets, you can skip steps 1-3 and go straight to step 4.</p>
<p >Steps 1 and 2 need to be performed on all of Windows, macOS and Linux, and on the various possible architectures (x86, x64 and arm64 for Windows, x64/Intel and arm64/Apple for macOS, and x64 and arm64 for Linux, both glibc and musl - no cross-compiling)! Otherwise, some native assets will be missing and it will not be possible to build the NuGet packages in step 3.</p>
<h2><a class="anchor" id="autotoc_md7"></a>
1. Building libmupdf</h2>
<p >You can download the open-source (GNU AGPL) MuPDF source code from <a href="https://mupdf.com/downloads/index.html">here</a>. You will need to uncompress the source file and compile the library on Windows, macOS and Linux. You need the following files:</p>
<ul>
<li>From Windows (x86, x64, arm64):<ul>
<li>libmupdf.lib</li>
</ul>
</li>
<li>From macOS (Intel - x64, Apple silicon - arm64):<ul>
<li>libmupdf.a</li>
<li>libmupdf-third.a</li>
</ul>
</li>
<li>From Linux (x64, arm64):<ul>
<li>libmupdf.a</li>
<li>libmupdf-third.a</li>
</ul>
</li>
</ul>
<p >Note that the files from macOS and Linux are different, despite sharing the same name.</p>
<p >For convenience, these compiled files for MuPDF 1.23.6 are included in the <a href="https://github.com/arklumpus/MuPDFCore/tree/master/native/MuPDFWrapper/lib"><code>native/MuPDFWrapper/lib</code> folder</a> of this repository.</p>
<details >
<p ><summary> <b>Tips for compiling MuPDF 1.23.6</b> </summary></p>
<ul>
<li>On all platforms:<ul>
<li>You do not need to follow the instructions in <code>thirdparty/tesseract.txt</code>, as in this version the <em>leptonica</em> and <em>tesseract</em> libraries are already included in the source archive.</li>
<li>Delete or comment line 316 in <code>source/fitz/output.c</code> (the <code>fz_throw</code> invocation within the <code>buffer_seek</code> method - this should leave the <code>buffer_seek</code> method empty). This line throws an exception when a seek operation on a buffer is attempted. The problem is that this makes it impossible to render a document as a PSD image in memory, because the <code>fz_write_pixmap_as_psd</code> method performs a few seek operations. By removing this line, we turn buffer seeks into no-ops; this doesn't seem to have catastrophic side-effects and the PSD documents produced in this way appear to be fine.</li>
</ul>
</li>
<li>On Windows (x64):<ul>
<li>Open the <code>platform/win32/mupdf.sln</code> solution in Visual Studio. You should get a prompt to retarget your projects. Accept the default settings (latest Windows SDK and v143 of the tools).</li>
<li>Select the <code>ReleaseTesseract</code> configuration and <code>x64</code> architecture. Select every project in the solution except <code>javaviewer</code> and <code>javaviewerlib</code> and right-click to open the project properties. Go to <code>C/C++</code> &gt; <code>Code Generation</code> and set the <code>Runtime Library</code> to <code>Multi-threaded DLL (/MD)</code>. Save everything (<code>CTRL+SHIFT+S</code>) and close Visual Studio.</li>
<li>Now, open the <code>x64 Native Tools Command Prompt for VS</code>, move to the folder with the solution file, and build it using <code>msbuild mupdf.sln</code></li>
<li>Then, build again using <code>msbuild mupdf.sln /p:Configuration=Release</code>. Ignore the compilation errors.</li>
<li>Finally, build again using <code>msbuild mupdf.sln /p:Configuration=ReleaseTesseract</code>.</li>
<li>This may still show some errors, but should produce the <code>libmupdf.lib</code> file that is required in the <code>x64/ReleaseTesseract</code> folder (the file should be ~510MB in size).</li>
</ul>
</li>
<li>On Windows (x86):<ul>
<li>You will have to use Visual Studio 2019, as Visual Studio 2022 is not supported on x86 platforms.</li>
<li>Open the <code>platform/win32/mupdf.sln</code> solution in Visual Studio and select the <code>ReleaseTesseract</code> configuration and <code>Win32</code> architecture. Select every project in the solution except <code>javaviewer</code> and <code>javaviewerlib</code> and right-click to open the project properties. Go to <code>C/C++</code> &gt; <code>Code Generation</code> and set the <code>Runtime Library</code> to <code>Multi-threaded DLL (/MD)</code>. Save everything (<code>CTRL+SHIFT+S</code>) and close Visual Studio.</li>
<li>Now, open the <code>x86 Native Tools Command Prompt for VS</code>, move to the folder with the solution file, and build it using <code>msbuild mupdf.sln /p:Platform=Win32</code></li>
<li>Then, build again using <code>msbuild mupdf.sln /p:Configuration=Release /p:Platform=Win32</code>. Ignore the compilation errors.</li>
<li>Finally, build again using <code>msbuild mupdf.sln /p:Configuration=ReleaseTesseract /p:Platform=Win32</code>.</li>
<li>This may still show some errors, but should produce the <code>libmupdf.lib</code> file that is required in the <code>ReleaseTesseract</code> folder (the file should be ~420MB in size).</li>
</ul>
</li>
<li><p class="startli">On Windows (arm64)</p>
<p class="startli">This is going to be a bit more complicated, because it appears that MuPDF is not meant to be built on ARM. These instructions will assume that you are building MuPDF on an ARM machine.</p>
<p class="startli">First of all, make sure that you have installed Visual Studio 2022 and have selected the C++ ARM64 build tools component of the "Desktop development with C++" workload.</p><ul>
<li>Download and extract the MuPDF source code and follow the instructions for all platforms above.</li>
<li>Add <code>|| defined(_M_ARM64)</code> at the end of line 16 in <code>scripts/tesseract/endianness.h</code>.</li>
<li>Open the file <code>thirdparty/openjpeg/src/lib/openjp2/ht_dec.c</code> and add the following after line 57 (<a href="https://github.com/ngtcp2/ngtcp2/commit/576f2d470cdf3da7b15348f4f609e4c7a0070499">source</a>): ```C unsigned int __popcnt(unsigned int x) { unsigned int c = 0; for (; x; ++c) { x &amp;= x - 1; } return c; } ``<code></code></li>
<li><code>Now we need to edit a few files in the</code>thirdparty/tesseract/src/arch<code>folder.<ul>
<li>Comment or delete lines 149-177 (inclusive) insimddetect.cpp<code>. You should now have an empty block between</code># elif defined(_WIN32)<code>and</code>#else<code>. Also comment or delete lines 198-220 (inclusive) and 237-260 (inclusive).</code></li>
<li><code>Comment or delete lines 20-22 (inclusive) in</code>dotproductsse.cpp<code>. Replace the whole body of the</code>DotProductSSE<code>method (lines 30-76) with</code>return DotProductNative(u, v, n);<code>.</code></li>
<li><code>Comment or delete lines 20-21 (inclusive) in</code>dotproductavx.cpp<code>. Replace the whole body of the</code>DotProductAVX<code>method (lines 29-54) with</code>return DotProductNative(u, v, n);<code>.</code></li>
<li><code>Comment or delete lines 20-21 (inclusive) in</code>dotproductfma.cpp<code>. Replace the whole body of the</code>DotProductFMA<code>method (lines 29-52) with</code>return DotProductNative(u, v, n);<code>.</code></li>
<li><code>Delete the contents of</code>thirdparty/tesseract/src/arch/intsimdmatrixavx2.cpp<code>and</code>thirdparty/tesseract/src/arch/intsimdmatrixsse.cpp<code>(do not delete the files, just their contents).</code></li>
<li><code>Comment or delete lines 120-121 (inclusive) in</code>intsimdmatrix.h`</li>
</ul>
</code></li>
<li><code>Open the <code>platform/win32/mupdf.sln</code> solution in Visual Studio. You should get a prompt to retarget your projects. Accept the default settings (latest Windows SDK and v143 of the tools).</code></li>
<li><code>In Visual Studio, click on the "Configuration Manager" item from the "Build" menu. In the new window, click on the drop down menu for the "Active solution platform" and select <code>&lt;New...&gt;</code>. In this new dialog, select the <code>ARM64</code> platform and choose to copy the settings from <code>x64</code>. Leave the <code>Create new project platforms</code> option enabled and click on <code>OK</code> (this may take some time).</code></li>
<li><code>Close the Configuration Manager and select the <code>ReleaseTesseract</code> configuration and <code>ARM64</code> architecture. Select every project in the solution except <code>javaviewer</code> and <code>javaviewerlib</code> and right-click to open the project properties. Go to <code>C/C++</code> &gt; <code>Code Generation</code> and set the <code>Runtime Library</code> to <code>Multi-threaded DLL (/MD)</code>.</code></li>
<li><code>Open the properties for the <code>libpkcs7</code> project, go to <code>C/C++</code> &gt; <code>Preprocessor</code> and remove <code>HAVE_LIBCRYPTO</code> from the <code>Preprocessor Definitions</code>. Then go to <code>Librarian</code> &gt; <code>General</code> and remove <code>libcrypto.lib</code> from the <code>Additional Dependencies</code>.</code></li>
<li><code>Save everything (<code>CTRL+SHIFT+S</code>) and close Visual Studio.</code></li>
<li><code>Create a new folder <code>platform/win32/Release</code>. Now, the problem is that the <code>bin2coff</code> script included with MuPDF cannot create <code>obj</code> files for ARM64 (only for x86 and x64). Since I could not find a version that can do this, I <a href="https://github.com/arklumpus/bin2coff">translated the source code of bin2coff to C# and added this option myself</a>. You can download an ARM64 <code>bin2coff.exe</code> from <a href="https://github.com/arklumpus/bin2coff/releases/latest/download/win-arm64.zip">here</a>; place it in the <code>Release</code> folder that you have just created.</code></li>
<li><code>Open the <code>Developer Command Prompt for VS</code>, move to the folder with the solution file (<code>platform/win32</code>), and build it using <code>msbuild mupdf.sln /p:Configuration=ReleaseTesseract</code>. Some compilation errors may occur towards the end, but they should not matter.</code></li>
<li><code>After a while, this should produce <code>libmupdf.lib</code> in the <code>ARM64/ReleaseTesseract</code> folder (the file should be ~506MB in size).</code></li>
</ul>
</li>
<li><code>On Linux (x64, for both <code>glibc</code>- and <code>musl</code>- based distros):<ul>
<li>Edit the <code>Makefile</code>, adding the <code>-fPIC</code> compiler option at the end of line 24 (which specifies the <code>CFLAGS</code>).</li>
<li>Comment line 218 in <code>include/mupdf/fitz/config.h</code> (for some reason, this seems to disable OCR even when using <code>USE_TESSERACT=yes</code> to build).</li>
<li>Make sure that you are using a recent enough version of GCC (version 7.3.1 seems to be enough).</li>
<li>Compile by running <code>USE_TESSERACT=yes make HAVE_X11=no HAVE_GLUT=no</code> (this builds just the command-line libraries and tools, and enables OCR through the included Tesseract library).</li>
</ul>
</code></li>
<li><code>On Linux (arm64, for both <code>glibc</code>- and <code>musl</code>- based distros):<ul>
<li>Edit the <code>Makefile</code>, adding the <code>-fPIC</code> compiler option at the end of line 24 (which specifies the <code>CFLAGS</code>).</li>
<li>Delete or comment line 218 in <code>thirdparty/tesseract/src/arch/simddetect.cpp</code>.</li>
<li>Make sure that you are using a recent enough version of GCC (version 7.3.1 seems to be enough).</li>
<li>Compile by running <code>USE_TESSERACT=yes make HAVE_X11=no HAVE_GLUT=no</code> (this builds just the command-line libraries and tools, and enables OCR through the included Tesseract library).</li>
</ul>
</code></li>
<li><code>On macOS (Intel - x64):<ul>
<li>Edit the <code>Makefile</code>, adding the <code>-fPIC</code> compiler option at the end of line 24 (which specifies the <code>CFLAGS</code>). Also add the <code>-std=c++11</code> option at the end of line 58 (which specifies the <code>CXX_CMD</code>).</li>
<li>Compile by running <code>USE_TESSERACT=yes make</code> (this enables OCR through the included Tesseract library).</li>
</ul>
</code></li>
<li><code>On macOS (Apple silicon - arm64)<ul>
<li>Edit the <code>Makefile</code>, adding the <code>-fPIC</code> compiler options at the end of line 24 (which specifies the <code>CFLAGS</code>). Also add the <code>-std=c++11</code> option at the end of line 58 (which specifies the <code>CXX_CMD</code>).</li>
<li>Delete or comment line 218 in <code>thirdparty/tesseract/src/arch/simddetect.cpp</code>.</li>
<li>Compile by running <code>USE_TESSERACT=yes make</code> (this enables OCR through the included Tesseract library). </li>
</ul>
</code></li>
</ul>
</details>
<p ><code></code></p>
<h2><a class="anchor" id="autotoc_md8"></a>
2. Building MuPDFWrapper</h2>
<p ><code> Once you have the required static library files, you should download the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code (just clone this repository) and place the library files in the appropriate subdirectories in the <code>native/MuPDFWrapper/lib/</code> folder (for Linux x64, copy the library built agains <code>glibc</code> to the <code>linux-x64</code> folder, and the library built against <code>musl</code> to the <code>linux-musl-x64</code> folder, and do the same for Linux arm64).</code></p>
<p ><code>To compile <code>MuPDFWrapper</code> you will need <a href="https://cmake.org/">CMake</a> (version 3.8 or higher) and (on Windows) <a href="https://ninja-build.org/">Ninja</a>.</code></p>
<p ><code>On Windows, the easiest way to get all the required tools is probably to install <a href="https://visualstudio.microsoft.com/it/">Visual Studio</a>. By selecting the "Desktop development with C++" workload you should get everything you need.</code></p>
<p ><code>On macOS, you will need to install at least the Command-Line Tools for Xcode (if necessary, you should be prompted to do this while you perform the following steps) and CMake.</code></p>
<p ><code>Once you have everything at the ready, you will have to build MuPDFWrapper on the seven platforms.</code></p>
<p ><code></p><details >
<p ><summary><b>Build instructions</b></summary></p>
<p ></p>
</details>
<p></code></p>
<h3><a class="anchor" id="autotoc_md9"></a>
Windows (x86 and x64)</h3>
<p ><code></p><ol type="1">
<li></li>
</ol>
<p></code></p>
<p ><code>Assuming you have installed Visual Studio, you should open the "&lt;strong&gt;x64&lt;/strong&gt; Native Tools Command Prompt for VS" or the "&lt;strong&gt;x86&lt;/strong&gt; Native Tools Command Prompt for VS" (you should be able to find these in the Start menu). Take care to open the version corresponding to the architecture you are building for, otherwise you will not be able to compile the library. A normal command prompt will not work, either.</code></p>
<p ><code> </code></p>
<p ><code><b>Note 1</b>: you <b>must</b> build the library on two separate systems, one running a 32-bit version of Windows and the other running a 64-bit version. If you try to build the x86 library on an x64 system, the system will probably build a 64-bit library and place it in the 32-bit output folder, which will just make things very confusing.</code></p>
<p ><code> </code></p>
<p ><code><b>Note 2 for Windows x86</b>: for some reason, Visual Studio might install the 64-bit version of CMake and Ninja, even though you are on a 32-bit machine. If this happens, you will have to manually install the 32-bit CMake and compile a 32-bit version of Ninja. You will notice if this is an issue because the 64-bit programs will refuse to run.</code></p>
<p ><code></p><ol type="1">
<li><code>CD</code> to the directory where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code.</li>
<li><code>CD</code> into the <code>native</code> directory.</li>
<li>Type <code>build</code>. This will start the <code>build.cmd</code> batch script that will delete any previous build and compile the library.</li>
</ol>
<p></code></p>
<p ><code>After this finishes, you should find a file named <code>MuPDFWrapper.dll</code> in the <code>native/out/build/win-x64/MuPDFWrapper/</code> directory or in the <code>native/out/build/win-x86/MuPDFWrapper/</code> directory. Leave it there.</code></p>
<p ><code></code></p>
<h3><a class="anchor" id="autotoc_md10"></a>
Windows (arm64)</h3>
<p ><code></p><ol type="1">
<li>Locate the batch file that sets up the developer command prompt environment. You can do this by finding the "Developer Command Prompt for VS" link in the start menu, then clicking on <code>Open file location</code>, opening the properties of the link and looking at the <code>Target</code>. This could be e.g. <code>C:\Program Files\Microsoft Visual Studio\2022\Preview\Common7\Tools\VsDevCmd.bat</code>.</li>
<li>Open a normal command prompt and invoke the batch script with the <code>-arch=arm64 -host_arch=x86</code> arguments (add quotes if there are spaces in the path to the batch script), e.g.: <div class="fragment"><div class="line">&quot;C:\Program Files\Microsoft Visual Studio\2022\Preview\Common7\Tools\VsDevCmd.bat&quot; -arch=arm64 -host_arch=x86</div>
</div><!-- fragment --></li>
<li><code>CD</code> to the directory where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code.</li>
<li><code>CD</code> into the <code>native</code> directory.</li>
<li>Type <code>build</code>. This will start the <code>build.cmd</code> batch script that will delete any previous build and compile the library.</li>
</ol>
<p></code></p>
<p ><code>After this finishes, you should find a file named <code>MuPDFWrapper.dll</code> in the <code>native/out/build/win-arm64/MuPDFWrapper/</code> directory. Leave it there.</code></p>
<p ><code></code></p>
<h3><a class="anchor" id="autotoc_md11"></a>
macOS and Linux</h3>
<p ><code></p><ol type="1">
<li>Assuming you have everything ready, open a terminal in the folder where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code.</li>
<li><code>cd</code> into the <code>native</code> directory.</li>
<li>Type <code>chmod +x build.sh</code>.</li>
<li>Type <code>./build.sh</code>. This will delete any previous build and compile the library.</li>
</ol>
<p></code></p>
<p ><code>After this finishes, you should find a file named <code>libMuPDFWrapper.dylib</code> in the <code>native/out/build/mac-x64/MuPDFWrapper/</code> directory (on macOS running on an Intel x64 processor) or in the <code>native/out/build/mac-arm64/MuPDFWrapper/</code> directory (on macOS running on an Apple silicon arm64 processor), and a file named <code>libMuPDFWrapper.so</code> in the <code>native/out/build/linux-XXX/MuPDFWrapper/</code> directory (on Linux - where <code>XXX</code> can be <code>x64</code>, <code>arm64</code>, <code>musl-x64</code>, or <code>musl-arm64</code>). Leave it there.</code></p>
<p ><code></code></p>
<p ><code></code></p>
<p ><code></code></p>
<h2><a class="anchor" id="autotoc_md12"></a>
3. Creating the native assets MuPDFCore NuGet packages</h2>
<p ><code> Once you have the <code>MuPDFWrapper.dll</code> (3x), <code>libMuPDFWrapper.dylib</code> (2x) and <code>libMuPDFWrapper.so</code> (4x) files, make sure they are in the correct folders (<code>native/out/build/xxx-yyy/MuPDFWrapper/</code>), <b>all on the same machine</b>.</code></p>
<p ><code>To create the native assets NuGet packages, you will need the <a href="https://dotnet.microsoft.com/download/dotnet/current">.NET Core 2.0 SDK or higher</a> for your platform. Once you have installed it and have everything ready, open a terminal in the folder where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code and type:</code></p>
<p ><code></p><div class="fragment"><div class="line">BuildNativeAssets</div>
</div><!-- fragment --><p></code></p>
<p ><code>This will create the NuGet packages in the <code>MuPDFCore.NativeAssets/NuGetPackages</code> folder. Once the script finishes, this folder should contain 9 files. Make sure you add this folder as a local NuGet source.</code></p>
<p ><code></code></p>
<h2><a class="anchor" id="autotoc_md13"></a>
4. Creating the MuPDFCore NuGet package</h2>
<p ><code> If you have made updates to the native assets, make sure to use the appropriate version numbers in <code>MuPDFCore/MuPDFCore.csproj</code>. Then, to create the main <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> NuGet package, open a terminal in the folder where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code and type:</code></p>
<p ><code></p><div class="fragment"><div class="line">cd MuPDFCore</div>
<div class="line">dotnet pack -c Release</div>
</div><!-- fragment --><p></code></p>
<p ><code>This will create a NuGet package in <code>MuPDFCore/bin/Release</code>. You can install this package on your projects by adding a local NuGet source.</code></p>
<p ><code></code></p>
<h2><a class="anchor" id="autotoc_md14"></a>
5. Running tests</h2>
<p ><code> To verify that everything is working correctly, you should build the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> test suite and run it on all platforms. To build the test suite, you will need the <a href="https://dotnet.microsoft.com/download/dotnet/current">.NET 6 SDK or higher</a>. You will also need to have enabled the <a href="https://docs.microsoft.com/en-us/windows/wsl/install">Windows Subsystem for Linux</a>.</code></p>
<p ><code>To build the test suite:</code></p>
<p ><code></p><ol type="1">
<li>Make sure that you have changed the version of the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> NuGet package so that it is higher than the latest version of <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> in the NuGet repository (you should use a pre-release suffix, e.g. <code>1.4.0-a1</code> to avoid future headaches with new versions of <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a>). This is set in line 9 of the <code>MuPDFCore/MuPDFCore.csproj</code> file.</li>
<li>Add the <code>MuPDFCore/bin/Release</code> folder to your local NuGet repositories (you can do this e.g. in Visual Studio).</li>
<li>If you have not done so already, create the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> NuGet package following step 3 above.</li>
<li>Update line 56 of the <code>Tests/Tests.csproj</code> project file so that it refers to the version of the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> package you have just created.</li>
</ol>
<p></code></p>
<p ><code>These steps ensure that you are testing the right version of <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> (i.e. your freshly built copy) and not something else that may have been cached.</code></p>
<p ><code>Now, open a Windows command line in the folder where you have downloaded the <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> source code, type <code>BuildTests</code> and press <code>Enter</code>. This will create a number of files in the <code>Release\MuPDFCoreTests</code> folder, where each file is an archive containing the tests for a certain platform and architecture:</code></p>
<p ><code></p><ul>
<li><code>MuPDFCoreTests-linux-x64.tar.gz</code> contains the tests for Linux environments using <code>glibc</code> on x64 processors.</li>
<li><code>MuPDFCoreTests-linux-arm64.tar.gz</code> contains the tests for Linux environments using <code>glibc</code> on arm64 processors.</li>
<li><code>MuPDFCoreTests-linux-musl-x64.tar.gz</code> contains the tests for Linux environments using <code>musl</code> on x64 processors.</li>
<li><code>MuPDFCoreTests-linux-musl-arm64.tar.gz</code> contains the tests for Linux environments using <code>musl</code> on arm64 processors.</li>
<li><code>MuPDFCoreTests-mac-x64.tar.gz</code> contains the tests for macOS environments on Intel processors.</li>
<li><code>MuPDFCoreTests-mac-arm64.tar.gz</code> contains the tests for macOS environments on Apple silicon processors.</li>
<li><code>MuPDFCoreTests-win-x64.tar.gz</code> contains the tests for Windows environments on x64 processors.</li>
<li><code>MuPDFCoreTests-win-x86.tar.gz</code> contains the tests for Windows environments on x86 processors.</li>
<li><code>MuPDFCoreTests-win-arm64.tar.gz</code> contains the tests for Windows environments on arm64 processors.</li>
</ul>
<p></code></p>
<p ><code>To run the tests, copy each archive to a machine running the corresponding operating system, and extract it (note: on Windows, the default zip file manager may struggle when extracting the text file with non-latin characters; you may need to manually extract this file). Then:</code></p>
<p ><code></code></p>
<h3><a class="anchor" id="autotoc_md15"></a>
Windows</h3>
<p ><code></p><ul>
<li>Open a command prompt and <code>CD</code> into the folder where you have extracted the contents of the test archive.</li>
<li>Enter the command <code>MuPDFCoreTestHost</code> (this will run the test program).</li>
</ul>
<p></code></p>
<p ><code></code></p>
<h3><a class="anchor" id="autotoc_md16"></a>
macOS and Linux</h3>
<p ><code></p><ul>
<li>Open a terminal and <code>cd</code> into the folder where you have extracted the contents of the test archive.</li>
<li>Enter the command <code>chmod +x MuPDFCoreTestHost</code> (this will add the executable flag to the test program).</li>
<li>Enter the command <code>./MuPDFCoreTestHost</code> (this will run the test program).</li>
<li>On macOS, depending on your security settings, you may get a message saying <code>zsh: killed</code> when you try to run the program. To address this, you need to sign the executable, e.g. by running <code>codesign --timestamp --sign &lt;certificate&gt; MuPDFCoreTestHost</code>, where <code>&lt;certificate&gt;</code> is the name of a code signing certificate in your keychain (e.g. <code>Developer ID Application: John Smith</code>). After this, you can try again to run the test program with <code>./MuPDFCoreTestHost</code>.</li>
</ul>
<p></code></p>
<p ><code>The test suite will start; it will print the name of each test, followed by a green <code>Succeeded</code> or a red <code>Failed</code> depending on the test result. If everything went correctly, all tests should succeed.</code></p>
<p ><code>When all the tests have been run, the program will print a summary showing how many tests have succeeded (if any) and how many have failed (if any). If any tests have failed, a list of these will be printed, and then they will be run again one at a time, waiting for a key press before running each test (this makes it easier to follow what is going on). If you wish to kill the test process early, you can do so with <code>CTRL+C</code>.</code></p>
<p ><code></code></p>
<h1><a class="anchor" id="autotoc_md17"></a>
Note about MuPDFCore and .NET Framework &lt;a name="netFrameworkNote"&gt;&lt;/a&gt;</h1>
<p ><code> If you wish to use <a class="el" href="namespace_mu_p_d_f_core.html">MuPDFCore</a> in a .NET Framework project, you will need to manually copy the native MuPDFWrapper library for the platform you are using to the executable directory (this is done automatically if you target .NET/.NET core).</code></p>
<p ><code>One way to obtain the appropriate library files is:</code></p>
<p ><code></p><ol type="1">
<li>Manually download the appropriate native assets NuGet package from the table below. Note that AnyCPU builds on Windows need the <code>win-x86</code> native asset.</li>
<li>Rename the <code>.nupkg</code> file so that it has a <code>.zip</code> extension.</li>
<li>Extract the zip file.</li>
<li>Within the extracted folder, the library files are in the <code>runtimes/xxx/native/</code> folder, where <code>xxx</code> is <code>linux-x64</code>, <code>linux-arm64</code>, <code>linux-musl-x64</code>, <code>linux-musl-arm64</code>, <code>osx-x64</code>, <code>osx-arm64</code>, <code>win-x64</code>, <code>win-x86</code> or <code>win-arm64</code>, depending on the platform you are using.</li>
<li>The file you need to copy should be called <code>MuPDFWrapper.dll</code> on Windows, <code>libMuPDFWrapper.so</code> or <code>MuPDFWrapper.so</code> on Linux, and <code>libMuPDFWrapper.dylib</code> on macOS.</li>
</ol>
<p></code></p>
<p ><code>Make sure you copy the appropriate file to the same folder as the executable!</code></p>
<p ><code></p><table align="center">
</table>
<p></code></p>
<p ><code> </code></p>
<p ><code><b>OS</b> </code></p>
<p ><code><b>Platform</b> </code></p>
<p ><code><b>NuGet package</b>  &lt;/thead&gt; &lt;tbody&gt; </code></p>
<p ><code> </code></p>
<p ><code>Windows </code></p>
<p ><code>x86 </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Win-x86/1.8.0">win-x86</a>  </code></p>
<p ><code> </code></p>
<p ><code>x64 </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Win-x64/1.8.0">win-x64</a>  </code></p>
<p ><code> </code></p>
<p ><code>arm64 </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Win-arm64/1.8.0">win-arm64</a>  </code></p>
<p ><code> </code></p>
<p ><code>Linux </code></p>
<p ><code>x64 </code></p>
<p ><code>glibc </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Linux-x64/1.8.0">linux-x64</a>  </code></p>
<p ><code> </code></p>
<p ><code>musl </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Linux-musl-x64/1.8.0">linux-musl-x64</a>  </code></p>
<p ><code> </code></p>
<p ><code>arm64 </code></p>
<p ><code>glibc </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Linux-arm64/1.8.0">linux-arm64</a>  </code></p>
<p ><code> </code></p>
<p ><code>musl </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Linux-musl-arm64/1.8.0">linux-musl-arm64</a>  </code></p>
<p ><code> </code></p>
<p ><code>macOS </code></p>
<p ><code>x64 (Intel) </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Mac-x64/1.8.0">osx-x64</a>  </code></p>
<p ><code> </code></p>
<p ><code>arm64 (Apple Silicon) </code></p>
<p ><code><a href="https://www.nuget.org/api/v2/package/MuPDFCore.NativeAssets.Mac-arm64/1.8.0">osx-arm64</a>  &lt;/tbody&gt; </code></p>
<p ><code> </code></p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.5 </li>
  </ul>
</div>
</body>
</html>
